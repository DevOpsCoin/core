<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>$DEVOPS — Vesting Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.min.js"></script>
</head>
<body class="bg-gray-950 text-gray-100 font-sans">
  <div class="max-w-2xl mx-auto mt-12 p-8 bg-gray-900 rounded-2xl shadow-lg">
    <h1 class="text-3xl font-bold text-teal-400 mb-6 text-center">Vesting Admin Panel</h1>

    <button id="connectWallet" class="w-full bg-teal-500 hover:bg-teal-400 text-black font-bold py-3 rounded-lg mb-6">
      Connect Admin Wallet
    </button>

    <select id="contractSelector" class="w-full mb-4 p-3 rounded bg-gray-800 border border-gray-700 text-white">
      <option value="0xTREASURY_VESTING_ADDRESS">Treasury Vesting</option>
      <option value="0xSHIPIT_VESTING_ADDRESS">Ship-It Fund Vesting</option>
    </select>

    <div class="space-y-4">
      <input id="beneficiary" class="w-full p-3 rounded bg-gray-800 border border-gray-700" placeholder="Beneficiary Address (0x...)" />
      <input id="amount" class="w-full p-3 rounded bg-gray-800 border border-gray-700" placeholder="Amount (tokens)" />
      <input id="duration" class="w-full p-3 rounded bg-gray-800 border border-gray-700" placeholder="Duration (seconds)" />
      <button id="addVesting" class="w-full bg-teal-500 hover:bg-teal-400 text-black font-bold py-3 rounded-lg">Add Vesting</button>
    </div>

    <div class="mt-8 space-y-3">
      <input id="revokeAddress" class="w-full p-3 rounded bg-gray-800 border border-gray-700" placeholder="Revoke Beneficiary Address" />
      <button id="revokeBtn" class="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-lg">Revoke Vesting</button>
    </div>

    <p id="status" class="text-center text-gray-400 mt-8 text-sm"></p>
  </div>

  <script>
    const ABI = [
      "function addVesting(address,uint256,uint64,uint64)",
      "function revokeVesting(address)"
    ];
    const TOKEN_DECIMALS = 18;
    let provider, signer;

    async function connectWallet() {
      if (!window.ethereum) {
        alert("MetaMask is required to use this site.");
        return;
      }
      provider = new ethers.BrowserProvider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = await provider.getSigner();
      document.getElementById("status").innerText = "✅ Wallet connected.";
    }

    async function addVesting() {
      const address = document.getElementById("beneficiary").value.trim();
      const amount = document.getElementById("amount").value.trim();
      const duration = document.getElementById("duration").value.trim();
      const start = Math.floor(Date.now() / 1000);
      const contractAddr = document.getElementById("contractSelector").value;
      const contract = new ethers.Contract(contractAddr, ABI, signer);

      try {
        document.getElementById("status").innerText = "Submitting transaction...";
        const tx = await contract.addVesting(address, ethers.parseUnits(amount, TOKEN_DECIMALS), start, duration);
        await tx.wait();
        document.getElementById("status").innerText = "✅ Vesting successfully added.";
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "❌ Error adding vesting.";
      }
    }

    async function revokeVesting() {
      const address = document.getElementById("revokeAddress").value.trim();
      const contractAddr = document.getElementById("contractSelector").value;
      const contract = new ethers.Contract(contractAddr, ABI, signer);

      try {
        document.getElementById("status").innerText = "Revoking...";
        const tx = await contract.revokeVesting(address);
        await tx.wait();
        document.getElementById("status").innerText = "✅ Vesting revoked successfully.";
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "❌ Error revoking vesting.";
      }
    }

    document.getElementById("connectWallet").addEventListener("click", connectWallet);
    document.getElementById("addVesting").addEventListener("click", addVesting);
    document.getElementById("revokeBtn").addEventListener("click", revokeVesting);
  </script>
</body>
</html>
